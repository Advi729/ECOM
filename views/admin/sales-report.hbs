<section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Sales Summary </h2>
                    {{!-- <p>Add, edit or delete a coupon</p> --}}
                </div>
                
            </div>
        <div class="card mb-4">

  <header class="card-header">
    <div class="row align-items-center">
      <form action="/admin/sort-report" method="post" class="form-inline">

        <span class="mr-5 mt-3" style="float: left;">From</span>

        <div class="form-group mr-5 align-items-center" style="float: left;">
          <input type="date" value="" class="form-control" name="fromDate" id="fromDate" required>
        </div>
        <span class="mr-5 mt-3" style="float: left;">To</span>

        <div class="form-group mr-5 align-items-center" style="float: left;">
          <input type="date" value="" class="form-control" name="toDate" id="toDate" required>
        </div>
        <div class="form-group mr-5 mt-1" style="float: left;">
          <button type="submit" class="btn btn-md rounded font-sm">Submit</button>
        </div>
        <div class="form-group mr-5 mt-1" style="float: right;">
          <button class="btn btn-primary" id="excel"><i class="text-muted material-icons md-post_add"></i>Download Excel</button>
          <button class="btn btn-primary" id="pdf"><i class="text-muted material-icons md-post_add"></i>Download Pdf</button>
        </div>
      </form>

    
    </div>
    
  </header>
</div>



                {{!-- <br> --}}

            <div class="card" id="sales-report">
                <div class="card-body">
                    <div class="row">
                        {{!-- <div class="col-md-3">
                            
                            
                                <div class="mb-4">
                                    <label class="form-label">Total Users</label>
                                    <input readonly type="number" value="{{totalUsers}}" class="form-control" id="product_name" />
                                </div>

                                <div class="mb-4">
                                    <label class="form-label">Total Products</label>
                                    <input readonly type="number" value="{{totalProducts}}" class="form-control" id="product_name" />
                                </div>

                                <div class="mb-4">
                                    <label class="form-label">Total Orders</label>
                                    <input readonly type="number" value="{{totalOrders}}" class="form-control" id="product_name" />
                                </div>

                                <div class="mb-4">
                                    <label class="form-label">Monthly Revenue</label>
                                    <input readonly type="text" value="{{formatNumber totalSales style='currency' currency='INR' minimumFractionDigits=2}}" class="form-control" id="product_name" />
                                </div>

                                <div class="mb-4">
                                    <label class="form-label">Total Revenue</label>
                                    <input readonly type="text" value="{{formatNumber totalRevenue style='currency' currency='INR' minimumFractionDigits=2}}" class="form-control" id="product_name" />



                                </div>

                                
                        </div> --}}
                        {{!-- <div class="col-md-9"> --}}
    
                            <div class="card-body">

<div class="row align-items-center">
      <h4 class="content-title card-title ms-2">Sales Report</h4>
    </div>
                              <div class="table-responsive">
                        <table class="table table-hover all-orders">
                            <thead>
                                <tr>
                                    
                                    <th scope="col">Total Users</th>
                                    <th scope="col">Total Products</th>
                                    <th scope="col">Total Orders</th>
                                    <th scope="col">Monthly Revenue</th>
                                    <th scope="col">Total Revenue</th>
                                    
                                </tr>
                            </thead>
                            <tbody>
                                
                                <tr>
                                    
                                    <td>{{totalUsers}}</td>
                                    <td>{{totalProducts}}</td>
                                    <td>{{totalOrders}}</td>
                                    <td>{{formatNumber totalSales style='currency' currency='INR' minimumFractionDigits=2}}</td>
                                    <td>{{formatNumber totalRevenue style='currency' currency='INR' minimumFractionDigits=2}}</td>
                                </tr>
                                
                               
                            </tbody>
                        </table>
                    </div>
                    <br>

<div class="row align-items-center">
      <h4 class="content-title card-title ms-2">Orders</h4>
    </div>
                    <div class="table-responsive">
                        <table id="sales-table" class="table table-hover all-orders">
                            <thead>
                                <tr>
                                    <th>Sl no.</th>
                                    <th scope="col">Order Id</th>
                                    <th scope="col">Billing name</th>
                                    {{!-- <th scope="col">Email</th> --}}
                                    <th scope="col">Total Price</th>
                                    <th scope="col">Payment method</th>
                                    <th scope="col">Date</th>
                                    
                                </tr>
                            </thead>
                            <tbody>
                                {{#each deliveredOrders.orderDetails}}
                                <tr>
                                    <td>{{index @index}}.</td>
                                    <td>{{orderId}}</td>
                                    <td><b>{{firstname}} {{lastname}}</b></td>
                                    {{!-- <td><template class="__cf_email__" data-cfemail="aec3cfdcd8c7c0eecbd6cfc3dec2cb80cdc1c3">[email&#160;protected]</template></td> --}}
                                    <td>
                                        {{#if grandTotalPrice}}
                                        {{formatNumber grandTotalPrice style="currency" currency="INR" minimumFractionDigits=2}}
                                        {{else}}
                                        {{formatNumber totalPrice style="currency" currency="INR" minimumFractionDigits=2}}
                                        {{/if}}
                                    </td>
                                    <td>
                                        {{#if (equal paymentMethod "cod")}}
                                        Cash on Delivery
                                        {{else if (equal paymentMethod "razorPay")}}
                                        Razor pay
                                        {{/if}}
                                    </td>
                                    <td>
                                        {{!-- {{moment createdAt format="DD MMMM YYYY" locale="en-in"}} --}}
                                        {{moment createdAt format='ddd, MMM D, YYYY, h:mmA'}}
                                    </td>
                                </tr>
                                {{/each}}
                               
                            </tbody>
                        </table>
                    </div> <!-- table-responsive //end -->
                </div>
                        {{!-- </div> <!-- .col// --> --}}
                    </div> <!-- .row // -->
                </div> <!-- card body .// -->
            </div> <!-- card .// -->
        </section> <!-- content-main end// -->


<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.8/xlsx.full.min.js"></script>

<script>
    
    // download sales report pdf
    $(document).ready(function () {
            $('#pdf').click(function (event) {
                event.preventDefault();
                Swal.fire({
                    icon: 'warning',
                    title: 'Are you sure?',
                    text: 'Do you want to download sales report pdf?',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    if (result.isConfirmed) {
                        var element = document.getElementById('sales-report');
                        let randomNumber = Math.random().toString(36).substr(2, 9);
                        var opt = {
                            margin: 0,
                            filename: 'SalesReport' + randomNumber + '.pdf',
                            html2canvas: { scale: 10 },
                            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                        };
                        html2pdf().set(opt).from(element).save();
                    }
                });
                
            })
        })

    // download sales report excel
    {{!-- $(document).ready(function () {
        $('#excel').on('click', function (event) {
            event.preventDefault();
                Swal.fire({
                    icon: 'warning',
                    title: 'Are you sure?',
                    text: 'Do you want to download sales report excel?',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    if (result.isConfirmed) {
                        const rows = $('#sales-table tr');
                        const data = [];
                        // Loop through rows and cells to build the data array
                        rows.each(function (index, row) {
                            const rowData = [];
                            $(row).find('th, td').each(function (index, cell) {
                                let value = $(cell).text().trim(); // Remove extra spaces from the value

                                if (index === 2 || index === 3) {
                                    // Remove extra spaces and quotation marks from price and payment mode values
                                    value = value.replace(/"/g, '');
                                }

                                rowData.push(value);
                            });
                            data.push(rowData);
                        });
                        // Convert the data array to a SheetJS workbook and sheet
                        const ws = XLSX.utils.aoa_to_sheet(data);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
                        // Save the workbook as an Excel file
                        XLSX.writeFile(wb, 'sales-table.xlsx');

                    }
                });
        });
    }); --}}

   $(document).ready(function () {
  $('#excel').on('click', function (event) {
    event.preventDefault();
    Swal.fire({
      icon: 'warning',
      title: 'Are you sure?',
      text: 'Do you want to download sales report excel?',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes'
    }).then((result) => {
      if (result.isConfirmed) {
        const rows = $('#sales-table tr');
        const data = [];
        // Loop through rows and cells to build the data array
        rows.each(function (index, row) {
          const rowData = [];
          $(row).find('th, td').each(function (index, cell) {
            let value = $(cell).text().trim(); // Remove extra spaces from the value
            if (index === 2 || index === 3) {
              // Remove extra spaces and quotation marks from price and payment mode values
              value = value.replace(/"/g, '');
            }
            rowData.push(value);
          });
          data.push(rowData);
        });
        // Get the table headings from the thead section
        const headings = $('#sales-table thead tr th').map(function() {
          return $(this).text().trim();
        }).get();
        // Add the headings to the beginning of the data array, if they are not already there
        if (!arraysEqual(data[0], headings)) {
          data.unshift(headings);
        }
        // Convert the data array to a SheetJS workbook and sheet
        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
        // Save the workbook as an Excel file
        XLSX.writeFile(wb, 'sales-table.xlsx');
      }
    });
  });
});

// Compare two arrays to see if they contain the same elements (in the same order)
function arraysEqual(arr1, arr2) {
  if (arr1.length !== arr2.length) return false;
  for (let i = 0; i < arr1.length; i++) {
    if (arr1[i] !== arr2[i]) return false;
  }
  return true;
}


</script>